{% extends "base.html" %}

{% block title %}Créer un projet - Data Collection{% endblock %}

{% block content %}
<div class="container-fluid py-4">

  <!-- Formulaire de création projet -->
  <div class="row justify-content-center align-items-center min-vh-100 d-none" id="createForm">
    <div class="col-xl-5 col-lg-6 col-md-8 col-sm-11">
      <div class="card shadow-lg border-0 rounded-3 animate__animated animate__fadeIn">
        <div class="card-header py-3 text-center fw-bold fs-4 theme-bg text-white">
          <i class="fas fa-folder-plus me-2"></i>Créer un nouveau projet
        </div>
        <div class="card-body bg-transparent py-4 px-4">
          <form method="POST">
            <div class="mb-3">
              <label for="name" class="form-label">Nom du projet</label>
              <input type="text" class="form-control" id="name" name="name" required>
            </div>

            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <textarea class="form-control" id="description" name="description" rows="3"></textarea>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="start_date" class="form-label">Date de début</label>
                <input type="date" class="form-control" id="start_date" name="start_date" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="end_date" class="form-label">Date de fin</label>
                <input type="date" class="form-control" id="end_date" name="end_date" required>
              </div>
            </div>

            <div class="mb-3">
              <label for="form_type" class="form-label">Type de formulaire</label>
              <select class="form-select" id="form_type" name="form_type" required>
                <option value="unique">Formulaire unique</option>
                <option value="multi">Formulaires multiples</option>
              </select>
            </div>

            <div class="d-flex justify-content-between">
              <button type="button" id="cancelBtn" class="btn btn-secondary">
                <i class="fas fa-times me-1"></i> Annuler
              </button>
              <button type="submit" class="btn btn-primary theme-bg">
                <i class="fas fa-check me-1"></i> Créer le projet
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Bloc projets récents -->
  <div id="projectsBlock">
    <div class="row">
      <div class="col-12">
        <div class="card shadow-sm animate__animated animate__fadeIn">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Projets récents</h5>
            <button id="showFormBtn" class="btn btn-primary btn-sm">
              <i class="fas fa-plus me-1"></i> Nouveau projet
            </button>
          </div>
          <div class="card-body bg-light">
            {% if projects %}
              <div class="table-responsive">
                <table class="table table-striped table-hover align-middle" id="projects-table">
                  <thead class="table-light">
                    <tr>
                      <th>Nom</th>
                      <th class="d-none d-md-table-cell">Description</th>
                      <th>Formulaires</th>
                      <th class="d-none d-sm-table-cell">Date de fin</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for project in projects[:5] %}
                    <tr>
                      <td><strong>{{ project.name }}</strong></td>
                      <td class="d-none d-md-table-cell">
                        {{ project.description[:50] }}{% if project.description|length > 50 %}...{% endif %}
                      </td>
                      <td><span class="badge bg-secondary">{{ project.forms|length }}</span></td>
                      <td class="d-none d-sm-table-cell">{{ project.end_date.strftime('%d/%m/%Y') }}</td>
                      <td>
                        <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn btn-sm btn-outline-primary">
                          Voir
                        </a>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info text-center py-4">
                <i class="fas fa-folder-open fa-3x mb-3"></i>
                <h5>Aucun projet créé</h5>
                <p>Commencez par créer votre premier projet</p>
                <button id="showFormBtn2" class="btn btn-primary">
                  <i class="fas fa-plus me-1"></i> Créer un projet
                </button>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Script JS -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const formDiv = document.getElementById("createForm");
    const projectsBlock = document.getElementById("projectsBlock");
    const showBtn1 = document.getElementById("showFormBtn");
    const showBtn2 = document.getElementById("showFormBtn2");
    const cancelBtn = document.getElementById("cancelBtn");

    function showForm() {
      formDiv.classList.remove("d-none");
      projectsBlock.classList.add("d-none");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    if (showBtn1) showBtn1.addEventListener("click", showForm);
    if (showBtn2) showBtn2.addEventListener("click", showForm);
    if (cancelBtn) cancelBtn.addEventListener("click", function () {
      formDiv.classList.add("d-none");
      projectsBlock.classList.remove("d-none");
    });
  });
</script>
{% endblock %}
